<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment - Rent A Car</title>
    <link rel="stylesheet" href="payment.css" />
    <link rel="stylesheet" href="../common/loader.css" />
  </head>
  <body>
    <!-- Page loader -->
    <div id="page-loader" class="page-loader" aria-hidden="true">
      <div class="loader-inner">
        <img src="../images/rentacarlogo.png" alt="Rent a Car" class="loader-logo" />
        <div class="spinner" aria-hidden="true"></div>
        <span class="sr-only" id="loader-status">Loading, please wait</span>
      </div>
    </div>
    <div class="payment-container">
      <div class="payment-left">
        <!-- Dark overlay will be added via CSS -->
      </div>
      <div class="payment-right">
        <a href="../vehicles/vehicles.html" class="back-btn">Back</a>
        <div class="payment-form-container">
          <div class="logo">
            <img src="../images/rentacarlogo.png" alt="Rent A Car Logo" />
            <h1 class="logo-text">
              Rent a
              <strong>Car</strong>
            </h1>
          </div>

          <div class="booking-summary">
            <h2>Booking Summary</h2>
            <div class="car-details">
              <img id="selected-car-image" src="" alt="Selected Car" />
              <div class="car-info">
                <h3 id="selected-car-name"></h3>
                <p id="selected-car-type"></p>
              </div>
            </div>
            <div class="booking-details">
              <div class="detail-item">
                <span class="label">Pick-up:</span>
                <span id="pickup-details" class="value"></span>
              </div>
              <div class="detail-item">
                <span class="label">Drop-off:</span>
                <span id="dropoff-details" class="value"></span>
              </div>
              <div class="detail-item">
                <span class="label">Duration:</span>
                <span id="duration" class="value"></span>
              </div>
              <div class="detail-item total">
                <span class="label">Total Amount:</span>
                <span id="total-amount" class="value"></span>
              </div>
            </div>
          </div>

          <form id="paymentForm" class="payment-form">
            <h2>Payment Details</h2>
            <div class="payment-methods">
              <button type="button" class="payment-method-btn active" data-method="card">
                <img src="../images/credit-card.png" alt="Credit/Debit Card" />
                Credit/Debit Card
              </button>
              <button type="button" class="payment-method-btn" data-method="gcash">
                <img src="../images/gcash.png" alt="GCash" />
                GCash
              </button>
              <button type="button" class="payment-method-btn" data-method="maya">
                <img src="../images/maya.png" alt="Maya" />
                Maya
              </button>
            </div>

            <div id="card-payment-form">
              <div class="form-group">
                <label for="cardName">Cardholder Name</label>
                <input type="text" id="cardName" required />
              </div>
              <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" required pattern="\d{16}" maxlength="16" />
              </div>
              <div class="card-details">
                <div class="form-group">
                  <label for="expiryDate">Expiry Date</label>
                  <input type="text" id="expiryDate" required pattern="\d{2}/\d{2}" placeholder="MM/YY" maxlength="5" />
                </div>
                <div class="form-group">
                  <label for="cvv">CVV</label>
                  <input type="text" id="cvv" required pattern="\d{3,4}" maxlength="4" />
                </div>
              </div>
            </div>

            <button type="submit" class="pay-btn">Pay Now</button>
          </form>

          <!-- GCash Payment Form -->
          <div id="gcash-payment-form" style="display: none">
            <div class="payment-qr">
              <img src="../images/gcash-qr.png" alt="GCash QR Code" />
              <p>Scan QR code with GCash app</p>
            </div>
            <div class="payment-instructions">
              <h3>How to pay with GCash:</h3>
              <ol>
                <li>Open your GCash app</li>
                <li>Tap "Pay QR"</li>
                <li>Scan the QR code above</li>
                <li>
                  Enter the exact amount:
                  <strong id="gcash-amount"></strong>
                </li>
                <li>Confirm payment in your GCash app</li>
              </ol>
            </div>
          </div>

          <!-- Maya Payment Form -->
          <div id="maya-payment-form" style="display: none">
            <div class="payment-qr">
              <img src="../images/maya-qr.png" alt="Maya QR Code" />
              <p>Scan QR code with Maya app</p>
            </div>
            <div class="payment-instructions">
              <h3>How to pay with Maya:</h3>
              <ol>
                <li>Open your Maya app</li>
                <li>Tap "Scan to Pay"</li>
                <li>Scan the QR code above</li>
                <li>
                  Enter the exact amount:
                  <strong id="maya-amount"></strong>
                </li>
                <li>Confirm payment in your Maya app</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="payment.js"></script>
    <script>
      (function () {
        const MIN_LOADER_MS = 200;
        const loader = document.getElementById("page-loader");
        let loaderShownAt = 0;

        function showLoader() {
          if (!loader) return (loaderShownAt = Date.now());
          loader.classList.remove("hidden");
          try {
            loader.setAttribute("aria-hidden", "false");
          } catch (e) {}
          loaderShownAt = Date.now();
        }

        function hideLoaderSoon() {
          const elapsed = Date.now() - loaderShownAt;
          const wait = Math.max(0, MIN_LOADER_MS - elapsed, 40);
          setTimeout(() => {
            if (loader) {
              loader.classList.add("hidden");
              try {
                loader.setAttribute("aria-hidden", "true");
              } catch (e) {}
            }
          }, wait);
        }

        document.addEventListener("DOMContentLoaded", function () {
          if (!loaderShownAt) loaderShownAt = Date.now();
          hideLoaderSoon();
        });

        ["pointerdown", "touchstart"].forEach((ev) =>
          document.addEventListener(
            ev,
            function (e) {
              const a = e.target.closest && e.target.closest("a");
              if (!a) return;
              const href = a.getAttribute("href");
              if (!href) return;
              if (href.startsWith("#") || href.startsWith("mailto:") || a.target === "_blank") return;
              showLoader();
            },
            { passive: true }
          )
        );

        document.addEventListener(
          "click",
          function (e) {
            const a = e.target.closest && e.target.closest("a");
            if (!a) return;
            const href = a.getAttribute("href");
            if (!href) return;
            if (href.startsWith("#") || href.startsWith("mailto:") || a.target === "_blank") return;
            try {
              const url = new URL(href, location.href);
              if (url.origin !== location.origin) return;
              e.preventDefault();
              showLoader();
              const elapsed = Date.now() - loaderShownAt;
              const remaining = Math.max(0, MIN_LOADER_MS - elapsed);
              setTimeout(() => (location.href = url.href), Math.max(200, remaining));
            } catch (e) {}
          },
          true
        );
      })();
    </script>
  </body>
</html>
